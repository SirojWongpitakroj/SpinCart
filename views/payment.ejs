<%- include("partials/header.ejs") %>

<style>
    .hide-scrollbar {
        -ms-overflow-style: none;  /* IE and Edge */
        scrollbar-width: none;  /* Firefox */
    }
    .hide-scrollbar::-webkit-scrollbar {
        display: none;  /* Chrome, Safari and Opera */
    }
</style>

    <section class="pt-16">
        <!-- Payment Header -->
        <div class="w-full bg-[#ffd174]">
            <h1 class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-12 flex items-center justify-center text-lg font-semibold text-gray-900">Payment</h1>
        </div>

        <!-- Main Content -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 grid grid-cols-1 md:grid-cols-3 gap-6 lg:gap-8">
            <!-- Left Column - Product Summary -->
            <div class="md:col-span-1">
                <div class="hide-scrollbar lg:max-h-[calc(100vh-12rem)] lg:overflow-y-auto lg:pr-2 lg:space-y-4 space-y-4">
                    <% items.forEach((item) => { %>
                        <!-- Product Item -->
                        <div class="bg-white rounded-xl shadow-sm p-4 lg:p-5">
                            <img src="<%= item.url %>" alt="<%= item.title %>" class="w-full h-40 lg:h-48 object-contain mb-3">
                            <h3 class="text-sm font-semibold text-gray-900 mb-1 line-clamp-2"><%= item.title %></h3>
                            <p class="text-xs text-gray-600 mb-2 line-clamp-2"><%= item.short_description %></p>
                            <div class="flex items-center justify-between gap-2">
                                <span class="font-semibold text-sm">฿<%= item.price * item.quantity %></span>
                                <span class="text-sm text-gray-600">Qty: <%= item.quantity %></span>
                            </div>
                        </div>
                    <% }); %>
                </div>
            </div>

            <!-- Right Column - Address and Credit Card -->
            <div class="md:col-span-2 space-y-6 lg:space-y-8">
                <!-- Address Section -->
                <div class="bg-white rounded-xl shadow-sm p-6 lg:p-8">
                    <h2 class="text-xl lg:text-2xl font-bold text-gray-900 mb-4 lg:mb-6">Address</h2>
                    <div class="space-y-4">
                        <!-- Address 1 -->
                        <div class="border-b border-gray-200 pb-4 last:border-0">
                            <p class="text-md font-semibold lg:text-base text-gray-700 mt-1 leading-relaxed"><%= user.address_line1 + " " + user.address_line2 + " " + user.city + " " + user.province + " " + user.country + " " + user.zipcode %></p>
                        </div>
                    </div>
                </div>

                <!-- Credit Card Section -->
                <div class="bg-white rounded-xl shadow-sm p-6 lg:p-8">
                    <h2 class="text-lg lg:text-xl font-semibold text-gray-900 mb-4 lg:mb-6">Credit Card</h2>
                    <div class="space-y-5 lg:space-y-6">
                        <!-- Card Number -->
                        <div>
                            <label class="block text-sm lg:text-base font-medium text-gray-700 mb-2">Card Number</label>
                            <h2 class="text-xl lg:text-2xl font-medium text-gray-900 tracking-wide"><%= locals.user.credit_card_number.toString().replace(/(\d{4})(?=\d)/g, '$1-') %></h2>
                        </div>
                        
                        <!-- Expiration and CVV -->
                        <div class="grid grid-cols-2 gap-4 lg:gap-6">
                            <div>
                                <label class="block text-sm lg:text-base font-medium text-gray-700 mb-2">Expiration</label>
                                <h2 class="text-xl lg:text-2xl font-medium text-gray-900"><%= locals.user.exp_date %></h2>
                            </div>
                            <div>
                                <label class="block text-sm lg:text-base font-medium text-gray-700 mb-2">CVC</label>
                                <h2 class="text-xl lg:text-2xl font-medium text-gray-900"><%= locals.user.cvc %></h2>
                            </div>
                        </div>
                        
                        <!-- Card Name -->
                        <div>
                            <label class="block text-sm lg:text-base font-medium text-gray-700 mb-2">Card Name</label>
                            <h2 class="text-xl lg:text-2xl font-medium text-gray-900"><%= locals.user.credit_card_fullname %></h2>
                        </div>
                    </div>
                    
                    <!-- Order Summary -->
                    <div class="mt-6 lg:mt-8 pt-6 lg:pt-8 border-t border-gray-200">
                        <h3 class="text-base lg:text-lg font-semibold text-gray-900 mb-4 lg:mb-5">Order Summary</h3>
                        <div class="space-y-3 lg:space-y-4">
                            <%
                                // Calculate subtotal
                                let subtotal = 0;
                                items.forEach(item => {
                                    subtotal += (item.price || item.unit_price) * item.quantity;
                                });
                                const shippingFee = 100;
                                const total = subtotal + shippingFee;
                            %>
                            <div class="flex justify-between text-sm lg:text-base">
                                <span class="text-gray-600">Subtotal</span>
                                <span class="text-gray-900 font-medium">฿<%= subtotal.toFixed(2) %></span>
                            </div>
                            <div class="flex justify-between text-sm lg:text-base">
                                <span class="text-gray-600">Shipping fee</span>
                                <span class="text-gray-900 font-medium">฿<%= shippingFee.toFixed(2) %></span>
                            </div>
                            <hr class="my-3 lg:my-4 border-gray-200">
                            <div class="flex justify-between text-base lg:text-lg font-semibold">
                                <span class="text-gray-900">Total</span>
                                <span class="text-gray-900">฿<%= total.toFixed(2) %></span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Checkout Button -->
                    <div class="flex justify-end mt-8 lg:mt-10">
                        <button id="checkout-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 lg:py-3.5 px-8 lg:px-10 rounded-full transition-colors duration-200 text-base lg:text-lg">
                            Checkout
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Success Popup -->
    <div id="success-popup" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 opacity-0 invisible transition-all duration-300 ease-in-out">
        <div class="bg-white rounded-2xl p-8 lg:p-10 shadow-2xl max-w-md w-full mx-4 transform scale-95 transition-transform duration-300">
            <!-- Success Icon -->
            <div class="flex justify-center mb-6">
                <div class="w-16 h-16 lg:w-20 lg:h-20 bg-green-500 rounded-full flex items-center justify-center">
                    <svg class="w-10 h-10 lg:w-12 lg:h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
            </div>
            <!-- Message -->
            <div class="text-center">
                <h2 class="text-2xl lg:text-3xl font-bold text-gray-900 mb-3">Payment Successful!</h2>
                <p class="text-base lg:text-lg text-gray-600">You have successfully paid for your order.</p>
            </div>
        </div>
    </div>

<%- include("partials/footer.ejs") %>

